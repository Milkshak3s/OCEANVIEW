---
- hosts: localhost
  tasks:
          - name: Add OSQuery repo (CentOS)
            yum: 
                name: https://osquery-packages.s3.amazonaws.com/centos7/noarch/osquery-s3-centos7-repo-1-0.0.noarch.rpm 
                state: present

          - name: Install OSQuery with yum
            yum:
                name: osquery
                state: present

          - name: Install dependencies
            yum:
                name: yum-utils
                state: latest
            yum:
                name: device-mapper-persistent-data
                state: latest
            yum:
                name: lvm2
                state: latest

          - name: Add docker repo
            shell: yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo

          - name: Install docker
            yum:
                name: docker-ce
                state: present

          - name: Start docker server
            service:
                name: docker
                state: started

          - name: Grab docker compose
            shell: curl -L https://github.com/docker/compose/releases/download/1.19.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose
